<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boot.infopass.mapper.WrongAnswerMapper">

  <insert id="insertWrongAnswer" parameterType="boot.infopass.dto.WrongAnswerDto">
    INSERT INTO wronganswer_log (user_id, game_type, question_id, submitted_answer, created_at)
    VALUES (#{userId}, 'oxquiz', #{questionId}, #{submittedAnswer}, NOW())
  </insert>

  <select id="selectWrongAnswersByUserId" parameterType="int" resultMap="WrongAnswerResultMap">
    SELECT wal.id, wal.user_id, wal.game_type, wal.question_id, wal.submitted_answer, wal.created_at,
           oxq.question,
           oxq.answer AS correct_answer
    FROM wronganswer_log wal
    LEFT JOIN oxquiz_question oxq
      ON wal.question_id = oxq.id AND wal.game_type = 'oxquiz'
    WHERE wal.user_id = #{userId}
    ORDER BY wal.created_at DESC
  </select>

  <resultMap id="WrongAnswerResultMap" type="boot.infopass.dto.WrongAnswerDto">
    <id property="id" column="id"/>
    <result property="userId" column="user_id"/>
    <result property="gameType" column="game_type"/>
    <result property="questionId" column="question_id"/>
    <result property="submittedAnswer" column="submitted_answer"/>
    <result property="createdAt" column="created_at"/>
    <result property="question" column="question"/>
    <result property="correctAnswer" column="correct_answer"/>
  </resultMap>

</mapper>
